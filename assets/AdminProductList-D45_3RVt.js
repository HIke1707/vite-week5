import{o as n,c as i,a as t,n as F,h as B,F as V,i as L,t as d,d as N,j as J,k as m,v as D,l as O,m as r,p as S,M as j,q as z,s as w,u as R,b as A}from"./index-BASYhDAa.js";const T={"aria-label":"Page navigation example"},q={class:"pagination"},W=t("span",{"aria-hidden":"true"},"«",-1),G=[W],H={key:0,class:"page-link"},K=["onClick"],Q=t("span",{"aria-hidden":"true"},"»",-1),X=[Q],Y={__name:"Pagination",props:{pages:1},emits:["emit-pages"],setup(a,{emit:g}){const y=g,h=u=>{y("emit-pages",u)};return(u,_)=>(n(),i("nav",T,[t("ul",q,[t("li",{class:F(["page-item",{disabled:a.pages.current_page===1}])},[t("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:_[0]||(_[0]=B(c=>h(a.pages.current_page-1),["prevent"]))},G)],2),(n(!0),i(V,null,L(a.pages.total_pages,(c,o)=>(n(),i("li",{key:o,class:F(["page-item",{active:c===a.pages.current_page}])},[c===a.pages.current_page?(n(),i("span",H,d(c),1)):(n(),i("a",{key:1,class:"page-link",href:"#",onClick:B(f=>h(c),["prevent"])},d(c),9,K))],2))),128)),t("li",{class:F(["page-item",{disabled:a.pages.current_page===a.pages.total_pages}])},[t("a",{class:"page-link",href:"#","aria-label":"Next",onClick:_[1]||(_[1]=B(c=>h(a.pages.current_page+1),["prevent"]))},X)],2)])]))}},Z={id:"detail"},tt=t("h2",null,"單一產品細節",-1),et={class:"card mb-3"},st=["src"],ot={class:"card-body"},lt={class:"card-title"},at={class:"badge bg-primary ms-2"},nt={class:"card-text"},it={class:"card-text"},ct={class:"d-flex"},dt={class:"card-text me-2"},rt={class:"card-text text-secondary"},ut=["src"],pt={class:"text-secondary"},mt={__name:"AdminProductDetail",props:{product:{type:Object,default:()=>new Product},hasFocus:!1},setup(a){return(g,y)=>(n(),i("div",Z,[tt,a.hasFocus?(n(),i(V,{key:0},[t("div",et,[t("img",{src:a.product.imageUrl,class:"card-img-top primary-image",alt:"主圖"},null,8,st),t("div",ot,[t("h5",lt,[N(d(a.product.title)+" ",1),t("span",at,d(a.product.category),1)]),t("p",nt,"商品描述："+d(a.product.description),1),t("p",it,"商品內容："+d(a.product.content),1),t("div",ct,[t("p",dt,d(a.product.price),1),t("p",rt,[t("del",null,d(a.product.origin_price),1)]),N(" 元 / "+d(a.product.unit),1)])])]),(n(!0),i(V,null,L(a.product.imagesUrl,(h,u)=>(n(),i("img",{key:u,src:h,alt:"",class:"images m-2"},null,8,ut))),128))],64)):J("",!0),m(t("p",pt,"請選擇一個商品查看",512),[[D,!a.hasFocus]])]))}},ht={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},_t={class:"modal-dialog"},bt={class:"modal-content border-0"},vt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),gt={class:"modal-body"},ft=t("strong",{class:"text-danger"},null,-1),yt={class:"modal-footer"},$t=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),wt={__name:"AdminDeleteModal",props:{propitem:null},emits:["close"],setup(a,{expose:g,emit:y}){const h=O("axios"),u="https://ec-course-api.hexschool.io/v2",_="yangapi",c=a,o=y,f=r(null),v=()=>{f.value.show()},U=()=>{f.value.hide()},k=async()=>{const x=c.propitem.id,M=`${u}/api/${_}/admin/product/${x}`;let $=!1;return await h.delete(M).then(P=>{const{success:C}=P.data;$=C,alert("已刪除商品"),U(),o("close")}).catch(P=>{alert(JSON.stringify(P))}),$};return S(async()=>{f.value=new j(document.getElementById("delProductModal"),{keyboard:!1})}),g({openModal:v,hideModal:U}),(x,M)=>(n(),i("div",ht,[t("div",_t,[t("div",bt,[vt,t("div",gt,[N(" 是否刪除 "),ft,N(" 商品"+d(a.propitem.title)+"(刪除後將無法恢復)。 ",1)]),t("div",yt,[$t,t("button",{type:"button",class:"btn btn-danger",onClick:M[0]||(M[0]=$=>k())}," 確認刪除 ")])])])],512))}},kt={id:"product-modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},xt={class:"modal-dialog modal-xl"},Mt={class:"modal-content border-0"},Ut={class:"modal-header bg-dark text-white"},Pt={id:"productModalLabel",class:"modal-title"},Ct=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Vt={class:"modal-body"},Nt={class:"row"},At={class:"col-sm-4"},Ft={class:"mb-2"},Lt={class:"mb-3"},Bt=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),Dt=["src"],Ot={key:0},St=["src"],jt=["onUpdate:modelValue"],Et={key:1},It={class:"col-sm-8"},Jt={class:"mb-3"},zt=t("label",{for:"title",class:"form-label"},"標題",-1),Rt={class:"row"},Tt={class:"mb-3 col-md-6"},qt=t("label",{for:"category",class:"form-label"},"分類",-1),Wt={class:"mb-3 col-md-6"},Gt=t("label",{for:"price",class:"form-label"},"單位",-1),Ht={class:"row"},Kt={class:"mb-3 col-md-6"},Qt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Xt={class:"mb-3 col-md-6"},Yt=t("label",{for:"price",class:"form-label"},"售價",-1),Zt=t("hr",null,null,-1),te={class:"mb-3"},ee=t("label",{for:"description",class:"form-label"},"產品描述",-1),se={class:"mb-3"},oe=t("label",{for:"content",class:"form-label"},"說明內容",-1),le={class:"mb-3"},ae={class:"form-check"},ne=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),ie={__name:"AdminProductModal",props:["isopen","isnew","propitem"],emits:["close"],setup(a,{expose:g,emit:y}){const h=O("axios"),u="https://ec-course-api.hexschool.io/v2",_="yangapi",c=a,o=r(c.propitem),f=y,v=r(null),U=()=>{v.value.show()},k=()=>{v.value.hide()},x=async()=>{const p=`${u}/api/${_}/admin/product`;let e=!1;const s={data:o.value};return await h.post(p,s).then(l=>{const{success:b}=l.data;e=b,console.log("addProduct",e)}).catch(l=>{alert(JSON.stringify(l))}),e},M=async()=>{const p=`${u}/api/${_}/admin/product/${o.value.id}`;let e=!1;const s={data:o.value};return await h.put(p,s).then(l=>{const{success:b}=l.data;e=b,console.log("update",e)}).catch(l=>{alert(JSON.stringify(l))}),e},$=async()=>{let p=!1;return p=c.isnew?await x():await M(),f("close"),k(),p},P=()=>{k()},C=()=>{o.value.imagesUrl=[],o.value.imagesUrl.push("")};return z(()=>c.propitem,(p,e)=>{o.value=p}),S(async()=>{v.value=new j(document.getElementById("product-modal"),{keyboard:!1})}),g({openModal:U,hideModal:k}),(p,e)=>(n(),i("div",kt,[t("div",xt,[t("div",Mt,[t("div",Ut,[t("h5",Pt,[t("span",null,d(a.isnew?"新增產品":"編輯產品"),1)]),Ct]),t("div",Vt,[t("div",Nt,[t("div",At,[t("div",Ft,[t("div",Lt,[Bt,m(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=s=>o.value.imageUrl=s)},null,512),[[w,o.value.imageUrl]])]),t("img",{class:"img-fluid",src:o.value.imageUrl,alt:""},null,8,Dt)]),Array.isArray(o.value.imagesUrl)?(n(),i("div",Ot,[(n(!0),i(V,null,L(o.value.imagesUrl,(s,l)=>(n(),i("div",{key:l},[t("img",{class:"img-fluid",src:s,alt:""},null,8,St),m(t("input",{type:"text",class:"form-control","onUpdate:modelValue":b=>o.value.imagesUrl[l]=b},null,8,jt),[[w,o.value.imagesUrl[l]]])]))),128)),t("div",null,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[1]||(e[1]=s=>o.value.imagesUrl.push(""))}," 新增圖片 ")]),t("div",null,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[2]||(e[2]=s=>o.value.imagesUrl.pop())}," 刪除圖片 ")])])):(n(),i("div",Et,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:C}," 新增圖片 ")]))]),t("div",It,[t("div",Jt,[zt,m(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[3]||(e[3]=s=>o.value.title=s)},null,512),[[w,o.value.title]])]),t("div",Rt,[t("div",Tt,[qt,m(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[4]||(e[4]=s=>o.value.category=s)},null,512),[[w,o.value.category]])]),t("div",Wt,[Gt,m(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[5]||(e[5]=s=>o.value.unit=s)},null,512),[[w,o.value.unit]])])]),t("div",Ht,[t("div",Kt,[Qt,m(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[6]||(e[6]=s=>o.value.origin_price=s)},null,512),[[w,o.value.origin_price,void 0,{number:!0}]])]),t("div",Xt,[Yt,m(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[7]||(e[7]=s=>o.value.price=s)},null,512),[[w,o.value.price,void 0,{number:!0}]])])]),Zt,t("div",te,[ee,m(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[8]||(e[8]=s=>o.value.content=s)},`
                    `,512),[[w,o.value.content]])]),t("div",se,[oe,m(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[9]||(e[9]=s=>o.value.description=s)},`
                    `,512),[[w,o.value.description]])]),t("div",le,[t("div",ae,[m(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[10]||(e[10]=s=>o.value.is_enabled=s)},null,512),[[R,o.value.is_enabled]]),ne])])])])]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:P}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:$}," 確認 ")])])])]))}},ce={class:"container"},de={class:"row py-3"},re={class:"col-md-6"},ue={class:"row"},pe=t("div",{class:"col-md-6"},[t("h2",{class:"w50"},"產品列表")],-1),me={class:"col-md-6"},he={class:"table table-hover mt-4"},_e=t("thead",null,[t("tr",null,[t("th",{width:"150"},"產品名稱"),t("th",{width:"120"}," 原價 "),t("th",{width:"120"}," 售價 "),t("th",{width:"140"}," 是否啟用 "),t("th",{width:"140"}," 查看細節 "),t("th",{width:"180"}," 動作 ")])],-1),be={width:"150"},ve={width:"120"},ge={width:"120"},fe={width:"140"},ye={class:"text-success"},$e={width:"140"},we=["onClick"],ke={width:"200"},xe=["onClick"],Me=["onClick"],Ue={class:"col-md-6"},Ce={__name:"AdminProductList",setup(a){const g=O("axios"),y="https://ec-course-api.hexschool.io/v2",h="yangapi",u=r([]),_=r(null),c=r(!1),o=r(!1),f=r(!1);r(null),r(0);const v=r({imagesUrl:[]}),U=r({}),k=r(null),x=r(null),M=e=>{_.value=e,c.value=!0},$=async(e=1)=>{const s=`${y}/api/${h}/admin/products?page=${e}`;await g.get(s).then(l=>{console.log(l);const b=l.data.products;u.value=Object.entries(b).map(([E,I])=>({id:E,...I})),U.value=l.data.pagination}).catch(l=>{console.log(l)})},P=async()=>{const e=`${y}/api/user/check`;let s=!1;return await g.post(e).then(l=>{const{success:b}=l.data;s=b}).catch(l=>{alert(l.message)}),s},C=()=>{o.value=!1,$()},p=(e,s)=>{e==="new"?(v.value={imagesUrl:[]},f.value=!0,x.value.openModal()):e==="edit"?(v.value={...s},f.value=!1,x.value.openModal()):e==="delete"&&(v.value={...s},k.value.openModal())};return S(()=>{var s;const e=(s=document.cookie.split("; ").find(l=>l.startsWith("hextoken=")))==null?void 0:s.split("=")[1];g.defaults.headers.common.Authorization=e,console.log(e),P().then(l=>{l?$():(alert("請登入"),window.location="#/login")})}),(e,s)=>(n(),i(V,null,[t("div",ce,[t("div",de,[t("div",re,[t("div",ue,[pe,t("div",me,[t("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#product-modal",style:{float:"right"},onClick:s[0]||(s[0]=l=>p("new",null))},"新增項目")])]),t("table",he,[_e,t("tbody",null,[(n(!0),i(V,null,L(u.value,l=>(n(),i("tr",{key:l.id,class:F([{"table-secondary":!l.is_enabled}])},[t("td",be,d(l.title),1),t("td",ve,d(l.origin_price),1),t("td",ge,d(l.price),1),t("td",fe,[m(t("span",ye,"啟用",512),[[D,l.is_enabled]]),m(t("span",null,"未啟用",512),[[D,!l.is_enabled]])]),t("td",$e,[t("button",{type:"button",class:"btn btn-primary",onClick:b=>M(l)},"查看細節",8,we)]),t("td",ke,[t("button",{type:"button",class:"btn btn-primary",onClick:b=>p("delete",l)},"刪除",8,xe),t("button",{type:"button",class:"btn btn-primary",onClick:b=>p("edit",l)},"編輯",8,Me)])],2))),128))])]),A(Y,{pages:U.value,onEmitPages:$},null,8,["pages"]),t("p",null,[N("目前有 "),t("span",null,d(u.value.length),1),N(" 項產品")])]),t("div",Ue,[A(mt,{product:_.value,"has-focus":c.value},null,8,["product","has-focus"])])])]),A(ie,{isnew:f.value,propitem:v.value,onClose:C,ref_key:"productModalRef",ref:x},null,8,["isnew","propitem"]),A(wt,{propitem:v.value,onClose:C,ref_key:"delProductModal",ref:k},null,8,["propitem"])],64))}};export{Ce as default};
